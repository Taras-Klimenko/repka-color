docker build -t tarasklimenko1989/brush-frontend:latest ./client
docker build -t tarasklimenko1989/brush-backend:latest ./server
docker push tarasklimenko1989/brush-frontend:latest
docker push tarasklimenko1989/brush-backend:latest

cd /opt/brush-app
docker compose pull
docker compose up -d

scp -i ~/.ssh/vps -r ./server/public root@178.128.205.56:/opt/brush-app/server/



.env

DB_PASSWORD="RepkaIsSoCool20082021"
ACCESS_TOKEN_SECRET="repka-morkovka"
REFRESH_TOKEN_SECRET="morkovka-repka"
NODE_ENV=production

services:
  frontend:
    image: tarasklimenko1989/brush-frontend:latest
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - backend
    environment:
      - API_URL=http://backend:3000
    volumes:
      - /etc/letsencrypt:/etc/letsencrypt:ro
    restart: unless-stopped

backend:
    image: tarasklimenko1989/brush-backend:latest
    ports:
      - "3000:3000"
    depends_on:
      - postgres
    environment:
      - DATABASE_URL=postgresql://brush_user:${DB_PASSWORD}@postgres:5432/brush_db         
      - ACCESS_TOKEN_SECRET=${ACCESS_TOKEN_SECRET}                                         
      - REFRESH_TOKEN_SECRET=${REFRESH_TOKEN_SECRET}                                       
      - CORS_ORIGIN=https://brush-app.net                                                  
      - NODE_ENV=production                                                                
    restart: unless-stopped                                                                
    volumes:                                                                               
      - ./server/public:/app/public

postgres:                                                                                
    image: postgres:15-alpine                                                              
    environment:                                                                           
      - POSTGRES_DB=brush_db                                                               
      - POSTGRES_USER=brush_user                                                           
      - POSTGRES_PASSWORD=${DB_PASSWORD}                                                   
    volumes:                                                                               
      - postgres_data:/var/lib/postgresql/data                                             
    restart: unless-stopped                                                                
    ports:                                                                                 
      - "5432:5432"                                                                        
                                                                                           
volumes:                                                                                   
  postgres_data: 
